<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>3D</title>

        <script type="text/javascript">
var zoom = 1.5; // Zoom in/out
var azimuth = 0; // Left/right
var elevation = 0; // Up/Down

function Point(X, Y) {
    this.x = X;
    this.y = Y;
}

function Point3D(X, Y, Z) {
	this.x = X;
	this.y = Y;
	this.z = Z;
}

function Edge(A, B, Color) {
	this.a = A;
	this.b = B;
	this.color = Color || "black";
}

var vertices = [
	new Point3D(-0.5, -0.5, -0.5), // 0
	new Point3D(-0.5, -0.5, 0.5),
	new Point3D(-0.5, 0.5, -0.5),
	new Point3D(-0.5, 0.5, 0.5),
	new Point3D(0.5, -0.5, -0.5),
	new Point3D(0.5, -0.5, 0.5),
	new Point3D(0.5, 0.5, -0.5),
	new Point3D(0.5, 0.5, 0.5), // 7

	new Point3D(-1.0, -0.25, -0.25), // 8
	new Point3D(-1.0, -0.25, 0.25),
	new Point3D(-1.0, 0.25, -0.25),
	new Point3D(-1.0, 0.25, 0.25),
	new Point3D(-0.5, -0.25, -0.25),
	new Point3D(-0.5, -0.25, 0.25),
	new Point3D(-0.5, 0.25, -0.25),
	new Point3D(-0.5, 0.25, 0.25), // 15

	new Point3D(0.5, -0.3, -0.3), // 16
	new Point3D(0.5, -0.3, 0.1),
	new Point3D(0.5, 0.1, -0.3),
	new Point3D(0.5, 0.1, 0.1),
	new Point3D(1.0, -0.3, -0.3),
	new Point3D(1.0, -0.3, 0.1),
	new Point3D(1.0, 0.1, -0.3),
	new Point3D(1.0, 0.1, 0.1), //23

	new Point3D(-0.65, 0.15, 0.15), //24
	new Point3D(0.25, 0.25, 0.25),
	new Point3D(0.9, 0, 0),

	new Point3D(-0.9, -0.15, -0.15), //27
	new Point3D(-0.25, -0.4, -0.35),
	new Point3D(0.6, -0.2, -0.2)
];

var edges = [
	new Edge(0, 1),
	new Edge(0, 2),
	new Edge(0, 4),
	new Edge(1, 3),
	new Edge(1, 5),
	new Edge(2, 3),
	new Edge(2, 6),
	new Edge(3, 7),
	new Edge(4, 5),
	new Edge(4, 6),
	new Edge(5, 7),
	new Edge(6, 7),

	new Edge(8, 9),
	new Edge(8, 10),
	new Edge(8, 12),
	new Edge(9, 11),
	new Edge(9, 13),
	new Edge(10, 11),
	new Edge(10, 14),
	new Edge(11, 15),
	new Edge(12, 13),
	new Edge(12, 14),
	new Edge(13, 15),
	new Edge(14, 15),

	new Edge(16, 17),
	new Edge(16, 18),
	new Edge(16, 20),
	new Edge(17, 19),
	new Edge(17, 21),
	new Edge(18, 19),
	new Edge(18, 22),
	new Edge(19, 23),
	new Edge(20, 21),
	new Edge(20, 22),
	new Edge(21, 23),
	new Edge(22, 23),

	new Edge(24, 25, "red"),
	new Edge(25, 26, "red"),

	new Edge(27, 28, "blue"),
	new Edge(28, 29, "blue")
];

function draw(){
	var canvas = document.getElementById("canvas3d");
	var width = canvas.offsetWidth;
	var height = canvas.offsetHeight;
	var context = canvas.getContext("2d");

	context.clearRect(0, 0, width, height);

	var theta = Math.PI * azimuth / 180.0;
	var phi = Math.PI * elevation / 180.0;
	var cosT = Math.cos(theta);
	var sinT = Math.sin(theta);
	var cosP = Math.cos(phi);
	var sinP = Math.sin(phi);
	var cosTcosP = cosT * cosP;
	var cosTsinP = cosT * sinP;
	var sinTcosP = sinT * cosP;
	var sinTsinP = sinT * sinP;

	// projecting vertices onto two-dimensional view-port
	var points = new Array(vertices.length);
	var scaleFactor = width / 2;
	var near = 3;
	var horizontal_offset = width / 2;

	for(var i = 0; i < vertices.length; i++) {
		var x0 = vertices[i].x;
		var y0 = vertices[i].y;
		var z0 = -vertices[i].z;
		var x1 = cosT * x0 + sinT * z0;
		var y1 = -sinTsinP * x0 + cosP * y0 + cosTsinP * z0;
		var z1 = cosTcosP * z0 - sinTcosP * x0 - sinP * y0;
		x1 = x1 * near / (z1 + near + zoom);
		y1 = y1 * near / (z1 + near + zoom);
		points[i] = new Point((horizontal_offset + scaleFactor * x1 + 0.5), (height / 2 - scaleFactor * y1 + 0.5));
	}

	// draw edges
	context.beginPath();
	var lastColor = context.strokeStyle = edges[0].color;
	for(var i = 0; i < edges.length; ++i) {
		var edge = edges[i];
		var startPoint = points[edge.a];
		var finishPoint = points[edge.b];
		if(edge.color !== lastColor) {
			context.stroke();
			context.beginPath();
			context.strokeStyle = lastColor = edge.color;
		}
		context.moveTo(startPoint.x,startPoint.y);
		context.lineTo(finishPoint.x,finishPoint.y);
	}
	context.stroke();
}

var zooming = false;
var lastPoint = null;
function mousedownHandler(event) {
	zooming = event.button === 2;
	lastPoint = {X:event.clientX, Y:event.clientY};
}
function mouseupHandler(event) { lastPoint = null; }
function mousemoveHandler(event) {
	if(lastPoint) {
		if(zooming) {
			zoom += (event.clientY - lastPoint.Y) * -0.1;
		} else {
			azimuth -= event.clientX - lastPoint.X;
			elevation += event.clientY - lastPoint.Y;
		}
		lastPoint = {X:event.clientX, Y:event.clientY};
		draw();
	}
}
function contextmenuHandler(event) {
	if(event.preventDefault) { event.preventDefault(); }
	event.returnValue = false;
	return false;
}
        </script>
    </head>
    <body onload="draw();"oncontextmenu="contextmenuHandler(event);">
        <canvas
                id="canvas3d"
                width="900"
                height="500"
                style="border:1px solid gray;"
                onmousedown="mousedownHandler(event);"
                onmouseup="mouseupHandler(event);"
                onmousemove="mousemoveHandler(event);"></canvas>
    </body>
</html>
