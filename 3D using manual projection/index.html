<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>3D</title>

        <script type="text/javascript">
var zoom = 1.5; // Zoom in/out
var azimuth = 0; // Left/right
var elevation = 0; // Up/Down

function Edge(A, B, Color) {
    this.a = A;
    this.b = B;
    this.color = Color || "black";
}

var vertices = [
    // Center cube.
    {x:-0.5, y:-0.5, z:-0.5}, // 0
    {x:-0.5, y:-0.5, z: 0.5},
    {x:-0.5, y: 0.5, z:-0.5},
    {x:-0.5, y: 0.5, z: 0.5},
    {x: 0.5, y:-0.5, z:-0.5},
    {x: 0.5, y:-0.5, z: 0.5},
    {x: 0.5, y: 0.5, z:-0.5},
    {x: 0.5, y: 0.5, z: 0.5}, // 7

    // Left cube.
    {x:-1.0, y:-0.25, z:-0.25}, // 8
    {x:-1.0, y:-0.25, z: 0.25},
    {x:-1.0, y: 0.25, z:-0.25},
    {x:-1.0, y: 0.25, z: 0.25},
    {x:-0.5, y:-0.25, z:-0.25},
    {x:-0.5, y:-0.25, z: 0.25},
    {x:-0.5, y: 0.25, z:-0.25},
    {x:-0.5, y: 0.25, z: 0.25}, // 15

    // Right cube.
    {x:0.5, y:-0.3, z:-0.3}, // 16
    {x:0.5, y:-0.3, z: 0.1},
    {x:0.5, y: 0.1, z:-0.3},
    {x:0.5, y: 0.1, z: 0.1},
    {x:1.0, y:-0.3, z:-0.3},
    {x:1.0, y:-0.3, z: 0.1},
    {x:1.0, y: 0.1, z:-0.3},
    {x:1.0, y: 0.1, z: 0.1}, //23

    // Red line
    {x:-0.65, y:0.15, z:0.15}, //24
    {x: 0.25, y:0.25, z:0.25},
    {x: 0.9 , y:0   , z:0},

    // Blue line
    {x:-0.9 , y:-0.15, z:-0.15}, //27
    {x:-0.25, y:-0.4 , z:-0.35},
    {x: 0.6 , y:-0.2 , z:-0.2}
];

var edges = [
    // Edges of the center cube.
    new Edge(0, 1),
    new Edge(0, 2),
    new Edge(0, 4),
    new Edge(1, 3),
    new Edge(1, 5),
    new Edge(2, 3),
    new Edge(2, 6),
    new Edge(3, 7),
    new Edge(4, 5),
    new Edge(4, 6),
    new Edge(5, 7),
    new Edge(6, 7),

    // Edges of the left cube.
    new Edge(8, 9),
    new Edge(8, 10),
    new Edge(8, 12),
    new Edge(9, 11),
    new Edge(9, 13),
    new Edge(10, 11),
    new Edge(10, 14),
    new Edge(11, 15),
    new Edge(12, 13),
    new Edge(12, 14),
    new Edge(13, 15),
    new Edge(14, 15),

    // Edges of the right cube.
    new Edge(16, 17),
    new Edge(16, 18),
    new Edge(16, 20),
    new Edge(17, 19),
    new Edge(17, 21),
    new Edge(18, 19),
    new Edge(18, 22),
    new Edge(19, 23),
    new Edge(20, 21),
    new Edge(20, 22),
    new Edge(21, 23),
    new Edge(22, 23),

    // The red line.
    new Edge(24, 25, "red"),
    new Edge(25, 26, "red"),

    // The blue line.
    new Edge(27, 28, "blue"),
    new Edge(28, 29, "blue")
];

function draw() {
    var canvas = document.getElementById("canvas3d"),
        width = canvas.offsetWidth,
        height = canvas.offsetHeight,
        context = canvas.getContext("2d");

    context.clearRect(0, 0, width, height);

    var theta = Math.PI * azimuth / 180.0,
        phi = Math.PI * elevation / 180.0,
        cosT = Math.cos(theta),
        sinT = Math.sin(theta),
        cosP = Math.cos(phi),
        sinP = Math.sin(phi),
        cosTcosP = cosT * cosP,
        cosTsinP = cosT * sinP,
        sinTcosP = sinT * cosP,
        sinTsinP = sinT * sinP;

    // Project 3D points onto 2D view-port.
    var near = 3,
        scaleFactor = width / 2,
        horizontal_offset = width / 2;

    for(var i = vertices.length; i-- > 0; ) {
        var vertex = vertices[i],
            x0 = vertex.x,
            y0 = vertex.y,
            z0 = -vertex.z,
            x1 = cosT * x0 + sinT * z0,
            y1 = -sinTsinP * x0 + cosP * y0 + cosTsinP * z0,
            z1 = cosTcosP * z0 - sinTcosP * x0 - sinP * y0,
            psf = near / (z1 + near + zoom) * scaleFactor;
        vertex.x2 = horizontal_offset + x1 * psf + 0.5;
        vertex.y2 = height / 2 - y1 * psf + 0.5;
    }

    // Draw edges
    context.beginPath();
    var lastColor = context.strokeStyle = edges[0].color;
    for(var i = edges.length; i-- > 0; ) {
        var edge = edges[i],
            startPoint = vertices[edge.a],
            finishPoint = vertices[edge.b];
        if(edge.color !== lastColor) {
            context.stroke();
            context.beginPath();
            context.strokeStyle = lastColor = edge.color;
        }
        context.moveTo(startPoint.x2, startPoint.y2);
        context.lineTo(finishPoint.x2, finishPoint.y2);
    }
    context.stroke();
}

var zooming = false;
var lastPoint = null;
function mousedownHandler(event) {
    zooming = event.button === 2;
    lastPoint = {X:event.clientX, Y:event.clientY};
}
function mouseupHandler(event) {
    lastPoint = null;
}
function mousemoveHandler(event) {
    if(lastPoint) {
        if(zooming) {
            zoom += (event.clientY - lastPoint.Y) * -0.1;
        } else {
            azimuth -= event.clientX - lastPoint.X;
            elevation += event.clientY - lastPoint.Y;
        }
        lastPoint = {X:event.clientX, Y:event.clientY};
        draw();
    }
}
function contextmenuHandler(event) {
    if(event.preventDefault) {
        event.preventDefault();
    }
    event.returnValue = false;
    return false;
}
        </script>
    </head>
    <body onload="draw();" oncontextmenu="contextmenuHandler(event);">
        <canvas
                id="canvas3d"
                width="900"
                height="500"
                style="border:1px solid gray;"
                onmousedown="mousedownHandler(event);"
                onmouseup="mouseupHandler(event);"
                onmousemove="mousemoveHandler(event);"></canvas>
    </body>
</html>
