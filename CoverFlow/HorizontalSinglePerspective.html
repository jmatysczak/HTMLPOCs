<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>CoverFlow</title>
        <style>
            .cover-container {
                /* This is just to get some white space on the top and left of the covers. Specifically trying to not be fancy here. */
                margin: 50px 150px;
                /*
                This controls how far away the covers are from the viewer.
                You'll notice that the covers in the middle look good and the ones on the ends look a little skewed in the first example.
                This is due to there being only one perspective. So the effect on the ends doesn't look as good because of the perspective.
                */
                perspective: 800px;
                -webkit-perspective: 800px;
                /* This enables the 3D look. */
                transform-style: preserve-3d;
                -webkit-transform-style: preserve-3d;
            }
            .cover {
                /* These are just to diplay the covers with the correct size. */
                background-repeat: no-repeat;
                display: inline-block;
                height: 240px;
                width: 160px;

                /* The top and bottom margins don't matter. The left and right margins have to be negative so the covers overlap. */
                margin: 0 -50px;
                /* Make the changes to rotation and margin transition smoothly. */
                transition: all 1s;
                /* By default a cover's left edge is closer than its right edge. */
                transform: rotateY(45deg);
                -webkit-transform: rotateY(45deg);
            }
            .cover:focus {
                /*
                When a cover is selected (gets focus by either clicking it or tabbing to it) give it a positive left and right margin so it has some space.
                The exact value is a matter of personal preference.
                If you use "auto" for the left and right margin there is no smooth transition (on Chrome at least).
                */
                margin: 0 20px;
                /*
                When a cover is selected (gets focus by either clicking it or tabbing to it) remove the rotation and bring it closer to the viewer a little.
                How much closer the cover is brought to the user is a matter of preference.
                */
                transform: rotateY(0deg) translateZ(100px);
                -webkit-transform: rotateY(0deg) translateZ(100px);
            }
            .cover:focus~.cover {
                /* All covers to the right of the selected cover get rotated so that their right edge is closer than their left edge. */
                transform: rotateY(-45deg);
                -webkit-transform: rotateY(-45deg);
            }

            #single-variable-perspective {
                /* When the perspective-origin is changed, the covers shift horizontally. This is transition is needed to make that movement slide instead of jump. */
                transition: all 1s;
            }
        </style>
    </head>
    <body>
        <strong>Browser Notes</strong>
        <div>
            - Only tested on Firefox 26.0 and Chrome 32.<br/>
            - Chrome does't appear to calculate the anchor area correctly when it is rotated. The
              edge "further away" from the view has an inactive/dead area between it and the center
              of the cover. If you click in this area the currently selected cover loses focus and
              no new cover gets focus.
        </div>
        <br/>
        <strong>Single, static perspective; no Javascript</strong>
        <div>
            - This coverflow has a single, static perspective and uses no Javascript for the effect.<br/>
            - You'll notice that the selected cover has increasing spacing on the side closer to
              the center as the position of the cover gets further from the center.<br/>
            - This is the same effect as watching a car go by. When the car is directly in front of
              you, only the side of the car can be seen. As the car approaches or departs, you see
              a combination of the side and either the front or the back.
            - Add "perspective-origin" to ".cover-container" and vary its horizontal component (0%,
              50%, 100%) to see how this effects the horizontal spacing of each cover when it is
              selected.
        </div>
        <div id="single-static-perspective" class="cover-container"></div>

        <strong>Single, variable perspective; Javascript is used to change the perspective origin</strong>
        <div>
            - Mostly the same as the above example except that the perspective origin is positioned
              directly in front of the slected cover.
        </div>
        <div id="single-variable-perspective" class="cover-container"></div>

        <script>
            var coverCount = 16,
                coversHTML = "";

            // Create the HTML for the covers.
            for(var i = 1; i <= coverCount; i++) coversHTML += "<a href='#' class='cover' style='background-image:url(images/" + i + ".jpg)' tabindex='1'></a>"

            // Create the covers for the single, static perspective example.
            document.getElementById("single-static-perspective").innerHTML = coversHTML;

            // Setup the single, variable perspective example.
            var singleVariablePerspective = document.getElementById("single-variable-perspective");
            // Create the covers for the single, variable perspective example.
            singleVariablePerspective.innerHTML = coversHTML;
            // Setup the single, variable perspective focus handler.
            var singleVariablePerspectiveCovers = singleVariablePerspective.getElementsByClassName("cover"),
                singleVariablePerspectiveMultiplier = singleVariablePerspective.lastChild.offsetLeft / coverCount,
                singleVariablePerspectiveCoverFocusHandler = function(e) {
                    // When a cover gets focus, update its container's horizontal perspective origin.
                    var cover = e.target,
                        indexOfCover = Array.prototype.indexOf.call(singleVariablePerspectiveCovers, cover),
                        horizontalPerspectiveOrigin = (indexOfCover * singleVariablePerspectiveMultiplier) + "px";
                    singleVariablePerspective.style.perspectiveOrigin = horizontalPerspectiveOrigin;
                    singleVariablePerspective.style.webkitPerspectiveOrigin = horizontalPerspectiveOrigin;
                };
            // Add the focus event handler to all of the covers.
            for(var i = singleVariablePerspectiveCovers.length; i-- > 0; ) singleVariablePerspectiveCovers[i].addEventListener("focus", singleVariablePerspectiveCoverFocusHandler, false);
        </script>
    </body>
</html>
